all_platforms: &all_platforms
  - name: &windows windows
    type: Unity::VM
    image: package-ci/win10:stable
    flavor: b1.large
  - name: &macOS macOS
    type: Unity::VM::osx
    image: package-ci/mac:stable
    flavor: m1.mac
  - name: &ubuntu ubuntu
    type: Unity::VM
    image: package-ci/ubuntu:stable
    flavor: b1.large

all_configurations:
  - name: &integration_tests integration_tests
    editors: [2019.4, 2020.3, 2021.2, trunk]
    platforms: *all_platforms
    args: --type package-tests
  - name: &isolation_tests isolation_tests
    editors: [2019.4, 2020.3, 2021.2, trunk]
    platforms: *all_platforms
    args: --type package-tests --enable-load-and-test-isolation
  - name: &coverage
    editors: [trunk]
    platforms: [*windows]
    args: --type package-tests --enable-code-coverage --code-coverage-options 'generateAdditionalMetrics;generateHtmlReport;assemblyFilters:+Cinemachine,+com.unity.cinemachine.editor'
  - name: &promotion_tests promotion_tests
    editors: [2019.4, 2020.3, 2021.2, trunk]
    platforms: *all_platforms
    args: --type vetting-tests --platform editmode

test_configurations: [*integration_tests, *isolation_tests, *coverage]
promote_configurations: [*promotion_tests]
publish_configurations: [*integration_tests, *isolation_tests, *promotion_tests]